openapi: 3.1.0
info:
  title: Trello Lite API
  version: 1.0.0
  description: |
    多使用者協作待辦系統（Trello Lite）REST API 合約。

    - Auth: cookie session（access + refresh rotation）
    - RBAC: Visitor/User + project roles（owner/admin/member/viewer）
    - Concurrency: optimistic concurrency control via `version`（409 on conflict）
    - Archived: 封存範圍唯讀（409）

servers:
  - url: http://localhost:3001
    description: Local dev

tags:
  - name: Auth
  - name: Projects
  - name: Invitations
  - name: Memberships
  - name: Boards
  - name: Lists
  - name: Tasks
  - name: Comments
  - name: Activity
  - name: Snapshots

paths:
  /health:
    get:
      summary: Health check
      responses:
        "200":
          description: OK

  /auth/register:
    post:
      tags: [Auth]
      summary: Register
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RegisterRequest"
      responses:
        "200":
          description: Registered and logged in
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthMeResponse"
        "422":
          $ref: "#/components/responses/ValidationError"

  /auth/login:
    post:
      tags: [Auth]
      summary: Login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LoginRequest"
      responses:
        "200":
          description: Logged in
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthMeResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "422":
          $ref: "#/components/responses/ValidationError"

  /auth/logout:
    post:
      tags: [Auth]
      summary: Logout (revoke refresh)
      security:
        - cookieAuth: []
      responses:
        "204":
          description: Logged out
        "401":
          $ref: "#/components/responses/Unauthorized"

  /auth/refresh:
    post:
      tags: [Auth]
      summary: Refresh access token (rotation)
      responses:
        "200":
          description: Rotated refresh and issued new access
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthMeResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /auth/me:
    get:
      tags: [Auth]
      summary: Get current user
      security:
        - cookieAuth: []
      responses:
        "200":
          description: Current user
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthMeResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /projects:
    get:
      tags: [Projects]
      summary: List projects visible to current user
      security:
        - cookieAuth: []
      responses:
        "200":
          description: Projects
          content:
            application/json:
              schema:
                type: object
                required: [projects, invitations]
                properties:
                  projects:
                    type: array
                    items:
                      $ref: "#/components/schemas/Project"
                  invitations:
                    type: array
                    items:
                      $ref: "#/components/schemas/ProjectInvitation"
        "401":
          $ref: "#/components/responses/Unauthorized"

    post:
      tags: [Projects]
      summary: Create project
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateProjectRequest"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Project"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "422":
          $ref: "#/components/responses/ValidationError"

  /projects/{projectId}:
    patch:
      tags: [Projects]
      summary: Update project (OCC)
      security:
        - cookieAuth: []
      parameters:
        - $ref: "#/components/parameters/ProjectId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateProjectRequest"
      responses:
        "200":
          description: Updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Project"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/VersionConflict"
        "422":
          $ref: "#/components/responses/ValidationError"

  /projects/{projectId}/archive:
    post:
      tags: [Projects]
      summary: Archive project (read-only)
      security:
        - cookieAuth: []
      parameters:
        - $ref: "#/components/parameters/ProjectId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ArchiveRequest"
      responses:
        "200":
          description: Archived
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Project"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/VersionConflict"

  /projects/{projectId}/snapshot:
    get:
      tags: [Snapshots]
      summary: Get project snapshot (authoritative state)
      security:
        - cookieAuth: []
      parameters:
        - $ref: "#/components/parameters/ProjectId"
      responses:
        "200":
          description: Snapshot
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProjectSnapshot"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

  /projects/{projectId}/invitations:
    get:
      tags: [Invitations]
      summary: List invitations for project (admin+)
      security:
        - cookieAuth: []
      parameters:
        - $ref: "#/components/parameters/ProjectId"
      responses:
        "200":
          description: Invitations
          content:
            application/json:
              schema:
                type: object
                required: [invitations]
                properties:
                  invitations:
                    type: array
                    items:
                      $ref: "#/components/schemas/ProjectInvitation"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

    post:
      tags: [Invitations]
      summary: Create invitation (owner/admin)
      security:
        - cookieAuth: []
      parameters:
        - $ref: "#/components/parameters/ProjectId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateInvitationRequest"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProjectInvitation"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"
        "422":
          $ref: "#/components/responses/ValidationError"

  /invitations/{invitationId}/accept:
    post:
      tags: [Invitations]
      summary: Accept invitation
      security:
        - cookieAuth: []
      parameters:
        - $ref: "#/components/parameters/InvitationId"
      responses:
        "200":
          description: Accepted
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProjectMembership"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"

  /invitations/{invitationId}/reject:
    post:
      tags: [Invitations]
      summary: Reject invitation
      security:
        - cookieAuth: []
      parameters:
        - $ref: "#/components/parameters/InvitationId"
      responses:
        "204":
          description: Rejected
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

  /projects/{projectId}/memberships:
    get:
      tags: [Memberships]
      summary: List memberships
      security:
        - cookieAuth: []
      parameters:
        - $ref: "#/components/parameters/ProjectId"
      responses:
        "200":
          description: Memberships
          content:
            application/json:
              schema:
                type: object
                required: [memberships]
                properties:
                  memberships:
                    type: array
                    items:
                      $ref: "#/components/schemas/ProjectMembership"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

  /projects/{projectId}/memberships/{membershipId}:
    patch:
      tags: [Memberships]
      summary: Update membership role (owner/admin, OCC)
      security:
        - cookieAuth: []
      parameters:
        - $ref: "#/components/parameters/ProjectId"
        - $ref: "#/components/parameters/MembershipId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateMembershipRequest"
      responses:
        "200":
          description: Updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProjectMembership"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/VersionConflict"
        "422":
          $ref: "#/components/responses/ValidationError"

  /projects/{projectId}/boards:
    post:
      tags: [Boards]
      summary: Create board
      security:
        - cookieAuth: []
      parameters:
        - $ref: "#/components/parameters/ProjectId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateBoardRequest"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Board"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/ArchivedReadonly"
        "422":
          $ref: "#/components/responses/ValidationError"

  /projects/{projectId}/boards/{boardId}:
    patch:
      tags: [Boards]
      summary: Update board (OCC)
      security:
        - cookieAuth: []
      parameters:
        - $ref: "#/components/parameters/ProjectId"
        - $ref: "#/components/parameters/BoardId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateBoardRequest"
      responses:
        "200":
          description: Updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Board"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/VersionConflict"
        "422":
          $ref: "#/components/responses/ValidationError"

  /projects/{projectId}/boards/{boardId}/archive:
    post:
      tags: [Boards]
      summary: Archive board
      security:
        - cookieAuth: []
      parameters:
        - $ref: "#/components/parameters/ProjectId"
        - $ref: "#/components/parameters/BoardId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ArchiveRequest"
      responses:
        "200":
          description: Archived
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Board"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/VersionConflict"

  /projects/{projectId}/boards/{boardId}/lists/reorder:
    post:
      tags: [Lists]
      summary: Reorder lists within a board (authoritative)
      security:
        - cookieAuth: []
      parameters:
        - $ref: "#/components/parameters/ProjectId"
        - $ref: "#/components/parameters/BoardId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ReorderListsRequest"
      responses:
        "200":
          description: Reordered
          content:
            application/json:
              schema:
                type: object
                required: [orderedListIds]
                properties:
                  orderedListIds:
                    type: array
                    items:
                      type: string
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/ArchivedReadonly"
        "422":
          $ref: "#/components/responses/ValidationError"

  /projects/{projectId}/lists:
    post:
      tags: [Lists]
      summary: Create list
      security:
        - cookieAuth: []
      parameters:
        - $ref: "#/components/parameters/ProjectId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateListRequest"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/List"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/ArchivedReadonly"
        "422":
          $ref: "#/components/responses/ValidationError"

  /projects/{projectId}/lists/{listId}:
    patch:
      tags: [Lists]
      summary: Update list (title/WIP settings, OCC)
      security:
        - cookieAuth: []
      parameters:
        - $ref: "#/components/parameters/ProjectId"
        - $ref: "#/components/parameters/ListId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateListRequest"
      responses:
        "200":
          description: Updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/List"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/VersionConflict"
        "422":
          $ref: "#/components/responses/ValidationError"

  /projects/{projectId}/lists/{listId}/archive:
    post:
      tags: [Lists]
      summary: Archive list
      security:
        - cookieAuth: []
      parameters:
        - $ref: "#/components/parameters/ProjectId"
        - $ref: "#/components/parameters/ListId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ArchiveRequest"
      responses:
        "200":
          description: Archived
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/List"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/VersionConflict"

  /projects/{projectId}/tasks:
    post:
      tags: [Tasks]
      summary: Create task
      security:
        - cookieAuth: []
      parameters:
        - $ref: "#/components/parameters/ProjectId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateTaskRequest"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Task"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"
        "422":
          $ref: "#/components/responses/ValidationError"

  /projects/{projectId}/tasks/{taskId}:
    patch:
      tags: [Tasks]
      summary: Update task (OCC)
      security:
        - cookieAuth: []
      parameters:
        - $ref: "#/components/parameters/ProjectId"
        - $ref: "#/components/parameters/TaskId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateTaskRequest"
      responses:
        "200":
          description: Updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Task"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/VersionConflict"
        "422":
          $ref: "#/components/responses/ValidationError"

  /projects/{projectId}/tasks/{taskId}/move:
    post:
      tags: [Tasks]
      summary: Move/reorder task (server authoritative ordering)
      security:
        - cookieAuth: []
      parameters:
        - $ref: "#/components/parameters/ProjectId"
        - $ref: "#/components/parameters/TaskId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/MoveTaskRequest"
      responses:
        "200":
          description: Moved
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Task"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          description: Conflict (version, WIP, archived)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "422":
          $ref: "#/components/responses/ValidationError"

  /projects/{projectId}/tasks/{taskId}/archive:
    post:
      tags: [Tasks]
      summary: Archive task
      security:
        - cookieAuth: []
      parameters:
        - $ref: "#/components/parameters/ProjectId"
        - $ref: "#/components/parameters/TaskId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ArchiveRequest"
      responses:
        "200":
          description: Archived
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Task"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/VersionConflict"

  /projects/{projectId}/tasks/{taskId}/comments:
    post:
      tags: [Comments]
      summary: Create comment (append-only)
      security:
        - cookieAuth: []
      parameters:
        - $ref: "#/components/parameters/ProjectId"
        - $ref: "#/components/parameters/TaskId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateCommentRequest"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Comment"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/ArchivedReadonly"
        "422":
          $ref: "#/components/responses/ValidationError"

  /projects/{projectId}/activity:
    get:
      tags: [Activity]
      summary: List activity log (append-only)
      security:
        - cookieAuth: []
      parameters:
        - $ref: "#/components/parameters/ProjectId"
        - name: cursor
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
            default: 50
      responses:
        "200":
          description: Activity entries
          content:
            application/json:
              schema:
                type: object
                required: [items]
                properties:
                  items:
                    type: array
                    items:
                      $ref: "#/components/schemas/ActivityLogEntry"
                  nextCursor:
                    type: string
                    nullable: true
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

components:
  securitySchemes:
    cookieAuth:
      type: apiKey
      in: cookie
      name: session

  parameters:
    ProjectId:
      name: projectId
      in: path
      required: true
      schema:
        type: string
    BoardId:
      name: boardId
      in: path
      required: true
      schema:
        type: string
    ListId:
      name: listId
      in: path
      required: true
      schema:
        type: string
    TaskId:
      name: taskId
      in: path
      required: true
      schema:
        type: string
    InvitationId:
      name: invitationId
      in: path
      required: true
      schema:
        type: string
    MembershipId:
      name: membershipId
      in: path
      required: true
      schema:
        type: string

  responses:
    Unauthorized:
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    Forbidden:
      description: Forbidden
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    NotFound:
      description: Not found
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    Conflict:
      description: Conflict
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    VersionConflict:
      description: Version conflict
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    ArchivedReadonly:
      description: Archived scope is read-only
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    ValidationError:
      description: Validation error
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"

  schemas:
    ErrorResponse:
      type: object
      required: [error]
      properties:
        error:
          type: object
          required: [code, message, requestId]
          properties:
            code:
              type: string
              description: Machine-readable error code
            message:
              type: string
              description: User-facing message
            requestId:
              type: string
              description: Correlates server logs
            details:
              type: object
              additionalProperties: true
              nullable: true

    RegisterRequest:
      type: object
      required: [email, password]
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          minLength: 8
        displayName:
          type: string
          nullable: true

    LoginRequest:
      type: object
      required: [email, password]
      properties:
        email:
          type: string
          format: email
        password:
          type: string

    AuthMeResponse:
      type: object
      required: [user]
      properties:
        user:
          $ref: "#/components/schemas/User"

    User:
      type: object
      required: [id, email, displayName, createdAt]
      properties:
        id:
          type: string
        email:
          type: string
          format: email
        displayName:
          type: string
        createdAt:
          type: string
          format: date-time

    CreateProjectRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string
        description:
          type: string
          nullable: true

    UpdateProjectRequest:
      type: object
      required: [version]
      properties:
        version:
          type: integer
          minimum: 0
        name:
          type: string
          nullable: true
        description:
          type: string
          nullable: true
        visibility:
          type: string
          enum: [private, shared]
          nullable: true

    ArchiveRequest:
      type: object
      required: [version]
      properties:
        version:
          type: integer
          minimum: 0
        reason:
          type: string
          nullable: true

    Project:
      type: object
      required: [id, name, status, version, createdAt, updatedAt]
      properties:
        id:
          type: string
        name:
          type: string
        description:
          type: string
          nullable: true
        status:
          type: string
          enum: [active, archived]
        visibility:
          type: string
          enum: [private, shared]
        version:
          type: integer
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    ProjectInvitation:
      type: object
      required: [id, projectId, email, invitedRole, status, createdAt]
      properties:
        id:
          type: string
        projectId:
          type: string
        email:
          type: string
          format: email
        invitedRole:
          type: string
          enum: [admin, member, viewer]
        status:
          type: string
          enum: [pending, accepted, rejected, revoked]
        createdAt:
          type: string
          format: date-time
        respondedAt:
          type: string
          format: date-time
          nullable: true

    CreateInvitationRequest:
      type: object
      required: [email, role]
      properties:
        email:
          type: string
          format: email
        role:
          type: string
          enum: [admin, member, viewer]

    ProjectMembership:
      type: object
      required: [id, projectId, userId, role, version, joinedAt]
      properties:
        id:
          type: string
        projectId:
          type: string
        userId:
          type: string
        role:
          type: string
          enum: [owner, admin, member, viewer]
        version:
          type: integer
        joinedAt:
          type: string
          format: date-time

    UpdateMembershipRequest:
      type: object
      required: [version, role]
      properties:
        version:
          type: integer
        role:
          type: string
          enum: [admin, member, viewer]

    Board:
      type: object
      required: [id, projectId, name, order, status, version, createdAt, updatedAt]
      properties:
        id:
          type: string
        projectId:
          type: string
        name:
          type: string
        order:
          type: number
        status:
          type: string
          enum: [active, archived]
        version:
          type: integer
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    CreateBoardRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string

    UpdateBoardRequest:
      type: object
      required: [version]
      properties:
        version:
          type: integer
        name:
          type: string
          nullable: true

    List:
      type: object
      required:
        [id, boardId, title, order, status, isWipLimited, version, createdAt, updatedAt]
      properties:
        id:
          type: string
        boardId:
          type: string
        title:
          type: string
        order:
          type: number
        status:
          type: string
          enum: [active, archived]
        isWipLimited:
          type: boolean
        wipLimit:
          type: integer
          nullable: true
        version:
          type: integer
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    CreateListRequest:
      type: object
      required: [boardId, title]
      properties:
        boardId:
          type: string
        title:
          type: string
        isWipLimited:
          type: boolean
          default: false
        wipLimit:
          type: integer
          nullable: true

    UpdateListRequest:
      type: object
      required: [version]
      properties:
        version:
          type: integer
        title:
          type: string
          nullable: true
        isWipLimited:
          type: boolean
          nullable: true
        wipLimit:
          type: integer
          nullable: true

    ReorderListsRequest:
      type: object
      required: [orderedListIds]
      properties:
        orderedListIds:
          type: array
          minItems: 1
          items:
            type: string

    Task:
      type: object
      required:
        [id, projectId, boardId, listId, title, position, status, version, createdAt, updatedAt]
      properties:
        id:
          type: string
        projectId:
          type: string
        boardId:
          type: string
        listId:
          type: string
        title:
          type: string
        description:
          type: string
          nullable: true
        dueDate:
          type: string
          format: date
          nullable: true
        position:
          type: string
          description: Sort key; server-generated
        status:
          type: string
          enum: [open, in_progress, blocked, done, archived]
        version:
          type: integer
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    CreateTaskRequest:
      type: object
      required: [boardId, listId, title]
      properties:
        boardId:
          type: string
        listId:
          type: string
        title:
          type: string
        description:
          type: string
          nullable: true

    UpdateTaskRequest:
      type: object
      required: [version]
      properties:
        version:
          type: integer
        title:
          type: string
          nullable: true
        description:
          type: string
          nullable: true
        status:
          type: string
          enum: [open, in_progress, blocked, done, archived]
          nullable: true

    MoveTaskRequest:
      type: object
      required: [toListId, expectedVersion]
      properties:
        toListId:
          type: string
        beforeTaskId:
          type: string
          nullable: true
        afterTaskId:
          type: string
          nullable: true
        expectedVersion:
          type: integer
        wipOverride:
          type: object
          nullable: true
          required: [enabled]
          properties:
            enabled:
              type: boolean
            reason:
              type: string
              nullable: true

    Comment:
      type: object
      required: [id, taskId, authorId, content, createdAt]
      properties:
        id:
          type: string
        taskId:
          type: string
        authorId:
          type: string
        content:
          type: string
        createdAt:
          type: string
          format: date-time

    CreateCommentRequest:
      type: object
      required: [content]
      properties:
        content:
          type: string
          minLength: 1

    ActivityLogEntry:
      type: object
      required: [id, projectId, actorId, entityType, entityId, action, timestamp]
      properties:
        id:
          type: string
        projectId:
          type: string
        actorId:
          type: string
        entityType:
          type: string
        entityId:
          type: string
        action:
          type: string
        timestamp:
          type: string
          format: date-time
        metadata:
          type: object
          additionalProperties: true
          nullable: true

    ProjectSnapshot:
      type: object
      required: [project, boards, lists, tasks, memberships]
      properties:
        project:
          $ref: "#/components/schemas/Project"
        boards:
          type: array
          items:
            $ref: "#/components/schemas/Board"
        lists:
          type: array
          items:
            $ref: "#/components/schemas/List"
        tasks:
          type: array
          items:
            $ref: "#/components/schemas/Task"
        memberships:
          type: array
          items:
            $ref: "#/components/schemas/ProjectMembership"
